{{ 'custom-tab-style.css' | asset_url | stylesheet_tag: preload: true }}

<style>
  #bs-collection-{{ section.id }} {
    background-color: {{ section.settings.section_bg }};
    padding: 30px 0;
  }
  .bs-product-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 20px;
  }

  @media (max-width: 1100px) {
    .bs-product-grid {
      display: none;
    }
    .bs-product-grid.slick-initialized {
      display: block;
    }
  }
</style>

<section id="bs-collection-{{ section.id }}" class="bs-collection-section">
  <div class="container container-fluid-custom-mobile-padding">
    <div class="bs-tab-title tt-block-title">
      <h2 class="tt-title">{{ section.settings.section_heading }}</h2>
      <p class="tt-description">{{ section.settings.section_sub_heading }}</p>
    </div>

    {% assign collection = collections[section.settings.collection] %}
    {% if collection and collection.products_count > 0 %}
      <div class="bs-collection-block">
        <div class="bs-product-grid product-slider">
          {% for product in collection.products limit: 4 %}
            <div class="bs-product-card tt-product">
              <div class="bs-product-img">
                <span class="tt-label-location product-featured-tag">
                  {% render 'featured-tag', product: product %}
                </span>
                <span class="custom--share">
                  <span class="custom-sharebtn">
                    {% render 'share-btn-code',
                      product: product,
                      trackingid: trackingid,
                      forloop--index: forloop.index
                    %}
                  </span>
                </span>
                <a href="{{ product.url }}">
                  <img
                    class="collection-img"
                    src="{{ product.featured_image | img_url: '400x' }}"
                    alt="{{ product.title }}"
                  >
                </a>
              </div>
              <div class="bs-product-details tt-description">
                <a class="bs-product-title tt-title" href="{{ product.url }}">{{ product.title }}</a>
                <div class="bs-product-price">
                  <strong>{{ product.price | money }}</strong>
                  {% if product.compare_at_price > product.price %}
                    <span class="compare-price">{{ product.compare_at_price | money }}</span>
                    <span class="badge badge-discount">
                      Save
                      <span>
                        {{-
                          product.compare_at_price
                          | minus: product.price
                          | times: 100
                          | divided_by: product.compare_at_price
                          | round
                        -}}
                        %
                      </span>
                    </span>
                  {% endif %}
                </div>
                <div class="custom-data-strip colpg">
                  {% if settings['freegift-img'] %}
                    {% assign pprice = product.selected_or_first_available_variant.price | divided_by: 100 %}
                    {% assign fprice = settings['free-gift-amt'] | strip | plus: 1 %}
                    <!-- code below will show free gift tag from metafield {{ pprice }}--{{ fprice }} -->
                    <div class="freegift_badge_container">
                      {% if pprice > fprice %}
                        {% if settings['free-gift-img'] != blank %}
                          <img
                            src="{{ settings.free-gift-img | img_url:'250x' }}"
                            width="100%"
                            height="40px"
                            alt="freegift"
                            class="freegift_badge"
                            srcset="{{ settings.free-gift-img | img_url:'250x' }}"
                          >
                        {% endif %}
                      {% endif %}

                      <!-- custom rating -->
                      {% include 'manual-rating' %}
                      <!-- custom rating end -->
                    </div>
                  {% endif %}
                  {%- unless product.metafields.custom.show_lightning_deal -%}
                    {% comment %} Add this condition on callout for lighting deal  {% endcomment %}
                  {% endunless %}
                  {% if product.tags contains 'single product' %}
                    {% comment %}single product condtion start  {% endcomment %}
                    {% if product.collections contains collections[settings['col-handle1']]
                      and settings['show-callout']
                    %}
                      {% unless product.title == ''
                        or product.title == ''
                        or product.collections contains collections[settings['col-handle2']]
                        or product.collections contains collections[settings['col-handle3']]
                        or product.collections contains collections[settings['col-handle4']]
                      %}
                        {% assign per-amt = settings['per-amt'] | strip | plus: 0 %}
                        <div class="salestags colllectionpg rpp callout1">
                          <span class="textsaletag rr ">
                            <img
                              class="offer-code"
                              src="{{'calloutimg.svg' |asset_url }}"
                              alt="discounttag"
                              width="18px"
                              height="18px"
                              srcset="{{ 'calloutimg.svg' | asset_url }}"
                            >
                            {{- settings['get-it-at'] }}
                            <b>{{ product.selected_or_first_available_variant.price | times: per-amt | money }}</b>
                            <br>
                          </span>
                          <span class="textsaletag">
                            {{ settings.usecode -}}
                          </span>
                        </div>
                      {% endunless %}
                    {% endif %}
                    {% comment %}first generic callout end   {% endcomment %}

                    {% if product.collections contains collections[settings['col-handle2']]
                      and settings['show-callout2']
                    %}
                      {% assign per-amt2 = settings['per-amt2'] | strip | plus: 0 %}
                      <div class="salestags colllectionpg rpp callout2">
                        <span class="textsaletag rr">
                          <img
                            class="offer-code"
                            src="{{'calloutimg.svg' |asset_url }}"
                            alt="discounttag"
                            width="18px"
                            height="18px"
                          >
                          {{- settings['get-it-at2'] -}}
                          <b>{{ product.selected_or_first_available_variant.price | times: per-amt2 | money }}</b>
                          <br>
                        </span>
                        <span class="textsaletag">
                          {{ settings.usecode2 -}}
                        </span>
                      </div>
                    {% endif %}
                    {% comment %}2nd collection based callout end   {% endcomment %}
                    {% if product.collections contains collections[settings['col-handle3']]
                      and settings['show-callout3']
                    %}
                      {% assign per-amt3 = settings['per-amt3'] | strip | plus: 0 %}
                      <div class="salestags colllectionpg  rpp callout3">
                        <span class="textsaletag rr">
                          <img
                            class="offer-code"
                            src="{{'calloutimg.svg' |asset_url }}"
                            alt="discounttag"
                            width="18px"
                            height="18px"
                          >

                          {{- settings['get-it-at3'] }}
                          <b>{{ product.selected_or_first_available_variant.price | times: per-amt3 | money }}</b>
                          <br>
                        </span>
                        <span class="textsaletag">
                          {{ settings.usecode3 }}
                        </span>
                      </div>
                    {% endif %}
                    {% comment %}3rd collection based callout end   {% endcomment %}
                    {% if product.collections contains collections[settings['col-handle4']]
                      and settings['show-callout4']
                    %}
                      {% assign per-amt4 = settings['per-amt4'] | strip | plus: 0 %}
                      <div class="salestags colllectionpg rpp callout4">
                        <span class="textsaletag rr "
                          ><img
                            class="offer-code"
                            src="{{'calloutimg.svg' |asset_url }}"
                            alt="discounttag"
                            width="18px"
                            height="18px"
                          >
                          {{- settings['get-it-at4'] }}
                          <b>{{ product.selected_or_first_available_variant.price | times: per-amt4 | money }}</b>
                          <br>
                        </span>
                        <span class="textsaletag">
                          {{ settings.usecode4 }}
                        </span>
                      </div>
                    {% endif %}
                    {% comment %}4th collection based  callout end   {% endcomment %}

                    {% if settings['show-callout5'] %}
                      {% comment %}Added condition for specific product only {% endcomment %}
                      {% if product.title == '' or product.title == '' %}
                        {% assign per-amt5 = settings['per-amt5'] | strip | plus: 0 %}
                        <div class="salestags colllectionpg rpp ppp gg">
                          <span class="textsaletag rr">
                            <img
                              class="offer-code"
                              src="{{ 'calloutimg.svg' | asset_url }}"
                              alt="discounttag"
                              width="18px"
                              height="18px"
                              srcset="{{ 'calloutimg.svg' | asset_url }}"
                            >
                            {{- settings['get-it-at5'] }}
                            <b>{{ product.selected_or_first_available_variant.price | times: per-amt5 | money }}</b>
                            | <br>
                          </span>
                          <span class="textsaletag">
                            {{ settings.usecode5 }}
                          </span>
                        </div>
                      {% endif -%}
                    {%- endif %}
                    {% comment %}fifth product based callout end   {% endcomment %}
                  {% endif %}
                  {% comment %}single product condtion end  {% endcomment %}
                </div>
                <div class="bs-atc-btn">
                  {% if settings.product_item_show_cart %}
                    <div class="productcardatc tt-row-btn">
                      <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-form">
                        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <input type="hidden" name="return_to" value="{{ request.path }}">
                        <button
                          type="submit"
                          id="{{ trackingid }}_atc_p0{{ forloop.index }}"
                          class="tt-btn-addtocart{% if settings.ajax_addtocart %} addtocart-item-js{% endif %}{% unless product.available %} disable{% endunless %}{% if product.metafields.custom.out_of_stock %} disable{% endif %} thumbprod-button-bg"
                          {% unless product.available %}
                            disabled
                          {% endunless %}
                          {% if product.metafields.custom.out_of_stock %}
                            disabled
                          {% endif %}
                        >
                          {% if product.available %}
                            {% if product.metafields.custom.out_of_stock %}
                              Sold Out
                            {% elsif product.selected_or_first_available_variant.inventory_management == 'shopify'
                              and product.selected_or_first_available_variant.inventory_policy == 'continue'
                              and product.selected_or_first_available_variant.inventory_quantity <= 0
                            %}
                              {{ 'products.general.preorder_html' | t }}
                            {% else %}
                              {{ 'products.general.add_to_cart_html' | t }}
                            {% endif %}
                          {% else %}
                            {{ 'products.general.unavailable_html' | t }}
                          {% endif %}
                        </button>
                      </form>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="bs-tab-viewall">
          <a class="link btn-border" href="{{ collection.url }}">View All</a>
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const grid = document.querySelector(".product-slider");

    function initSlickIfMobile(grid) {
      if (window.innerWidth <= 1100 && !grid.classList.contains("slick-initialized")) {
        $(grid).slick({
          slidesToShow: 3,
          slidesToScroll: 1,
          arrows: false,
          dots: false,
          infinite: false,
          responsive: [
            {
              breakpoint: 780,
              settings: {
                slidesToShow: 2,
              },
            },
          ],
        });
      }
    }

    if (grid) {
      initSlickIfMobile(grid);

      window.addEventListener("resize", function () {
        if ($(grid).hasClass("slick-initialized")) {
          $(grid).slick("unslick");
        }
        initSlickIfMobile(grid);
      });
    }
  });
</script>

{% schema %}
{
  "name": "Custom Horizontal",
  "settings": [
    {
      "type": "color",
      "id": "section_bg",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "section_heading",
      "label": "Section Heading",
      "default": "Featured Collection"
    },
    {
      "type": "text",
      "id": "section_sub_heading",
      "label": "Section Sub Heading",
      "default": "Explore our top picks"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Custom Horizontal",
      "category": "Custom"
    }
  ]
}
{% endschema %}
