<section id="web-stories{{ section.id }}" class="web-stories-section">
  <div class="container">
    <div class="ws-wrap">
      <div class="story-head-wrap">
        <h1>{{ section.settings.head }}</h1>
        <p>{{ section.settings.subhead }}</p>
      </div>
      <div class="web-stories-wrapper">
        {% for block in section.blocks %}
          {% assign slug = block.settings.title | handleize %}
          <div class="story" data-story-slug="{{ slug }}">
            <div class="story-icon">
              {% render 'story-icon' %}
            </div>
            <div class="story-thumb" style="background-image: url('{{ block.settings.image_1 | image_url }}');"></div>
            <div class="story-heading">{{ block.settings.title }}</div>
          </div>
        {% endfor %}
      </div>

      <!-- Modal Viewer -->
      <div class="story-modal"  id="story-modal" style="display:none;">
        <div class="story-slider" id="story-slider">
          <div class="progress-container" id="progress-container"></div>
          <button id="story-share-btn" class="story-share-btn">{% render 'share-icon' %}</button>
          <img id="story-img" src="">
          <div class="story-wrap">
            <div id="story-title" class="story-title"></div>
            <p id="story-desc" class="story-desc"></p>
            <a id="story-link" class="story-link" href="#" target="_blank"></a>
          </div>
          <button class="nav-btn" id="prev-img">
            
<svg width="14" height="24" viewBox="0 0 14 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.8933 2.30512C10.4512 1.74725 11.3557 1.74725 11.9136 2.30512C12.4715 2.86297 12.4715 3.76755 11.9136 4.3254L4.35231 11.8867L11.9136 19.448C12.4715 20.0059 12.4715 20.9104 11.9136 21.4682C11.3557 22.0262 10.4512 22.0262 9.8933 21.4682L1.32185 12.8968C0.763964 12.3389 0.763964 11.4344 1.32185 10.8765L9.8933 2.30512Z" fill="#3980C3"/>
</svg>
          </button>
          <button class="nav-btn" id="next-img">
            
<svg width="14" height="24" viewBox="0 0 14 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M4.1067 2.30512C3.5488 1.74725 2.64429 1.74725 2.08639 2.30512C1.5285 2.86297 1.5285 3.76755 2.08639 4.3254L9.64769 11.8867L2.08639 19.448C1.5285 20.0059 1.5285 20.9104 2.08639 21.4682C2.64429 22.0262 3.5488 22.0262 4.1067 21.4682L12.6782 12.8968C13.236 12.3389 13.236 11.4344 12.6782 10.8765L4.1067 2.30512Z" fill="#3980C3"/>
</svg>
          </button>
        </div>
        <button class="close-modal" onclick="closeStory()">Ã—</button>
      </div>
    </div>
  </div>
</section>

<style>
  section#web-storiestemplate--18350428487869__web_stories_NHgUL8 {
    padding: 50px 0;
  }
  .web-stories-wrapper {
    padding-top: 40px;
  }
  .story-head-wrap h1 {
    color: #06374F;
    text-align: center;
    font-family: 'MikadoMedium';
    font-size: 40px !important;
    font-style: normal;
    font-weight: 500 !important;
    line-height: normal !important;
  }
  .story-head-wrap p {
    color: #06374F;
    font-family: 'AvenirRegular';
    font-size: 20px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
    text-align: center;
    margin-top: 5px !important
  }
  .web-stories-wrapper {
    display: grid;
    gap: 40px;
    overflow-x: auto;
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }
  .story {
    cursor: pointer;
    width: 100%;
    flex-shrink: 0;
    text-align: center;
    position: relative;
  }
  .story:before {
    content: '';
    width: 100%;
    height: 100%;
    background-image: url(https://cdn.shopify.com/s/files/1/0568/1945/0045/files/Rectangle_19290_1.png?v=1747726525);
    position: absolute;
    background-repeat: no-repeat;
    background-size: cover;
    left: 0;
    bottom: 0;
    border-radius: 5px
  }
  .story-thumb {
    width: 100%;
    height: 380px;
    background-size: cover;
    background-position: center;
    border-radius: 5px;
  }
  .story-heading {
    color: #FFF;
    font-family: 'AvenirRegular';
    font-size: 16px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
    position: absolute;
    bottom: 0;
    text-align: left;
    padding: 0 10px 25px;
  }
  .story-icon {
    position: absolute;
    right: 8px;
    top: 8px;
  }
  .story-modal {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
    padding: 1rem;
  }
  .story-slider {
    position: relative;
    text-align: center;
    max-width: 90vw;
  }
  #story-img {
    max-height: 100%;
    height: 100vh;
    max-width: 100%;
    cursor: pointer;
    width: 100%;
  }
  .story-title {
    color: #FFF;
    text-align: center;
    font-family: 'MikadoRegular';
    font-size: 32px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
  }
  .story-desc {
    color: #FFF;
    text-align: center;
    font-family: 'AvenirRegular';
    font-size: 24px;
    font-style: normal;
    font-weight: 350;
    line-height: normal;
    margin: 0;
  }
  .story-link {
    border-radius: 4px;
    background: #FF805A;
    width: 100%;
    max-width: 130px;
    height: 40px;
    align-items: center;
    justify-content: center;
    color: #FFF;
    text-align: center;
    font-family: 'MikadoRegular';
    font-size: 18px;
    font-style: normal;
    font-weight: 500;
    line-height: normal;
    margin: 20px auto 0;
  }
  .story-link:hover {
    color: #ffffff
  }
.close-modal {
    margin-top: 0;
    background: #fff;
    border: none;
    font-size: 26px;
    padding: 0;
    border-radius: 50%;
    cursor: pointer;
    position: absolute;
    right: 40px;
    top: 20px;
    width: 35px;
    height: 35px;
}
.nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    background: #ffffff;
    border: none;
    padding: 0;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  border: 1px solid #3980C3;
}
  #prev-img { left: -70px; }
  #next-img { right: -70px; }
  .story-wrap {
    position: absolute;
    bottom: 0;
    background: #00000085;
    padding: 50px 10px 30px;
    border-radius: 50px 50px 0 0;
    width: 100%;
  }

  /* Progress Bars */
  .progress-container {
    display: flex;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 10px;
    gap: 4px;
    z-index: 10;
  }
  .progress-bar {
    flex: 1;
    height: 4px;
    background-color: rgb(186 186 186 / 30%);
    border-radius: 2px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    width: 0%;
    background-color: white;
    transition: width 0.2s linear;
  }
  .story-share-btn {
    cursor: pointer;
    background: transparent;
    border: none;
    position: absolute;
    right: 0;
    top: 15px;
  }
  .story-share-btn:hover {
    background-color: transparent;
  }
  @media (max-width: 650px) {
    section#web-storiestemplate--18350428487869__web_stories_NHgUL8 { padding: 30px 0; }
    .web-stories-wrapper { grid-row-gap: 15px; grid-column-gap: 10px; grid-template-columns: 1fr 1fr; }
    .story-slider { max-width: 100vw; }
    .story-head-wrap h1 { font-size: 30px !important; padding: 0 !important; }
    .web-stories-wrapper { padding-top: 30px; }
    .story-heading { font-size: 14px; padding: 0 10px 15px; }
    .story-modal { padding: 0 !important }
    .story-title { font-size: 20px; }
    .story-desc { font-size: 16px; padding-top: 5px; }
    .story-wrap { padding: 25px 10px 30px; border-radius: 70px 70px 0 0; }
    .story-share-btn { top: 60px }
    .close-modal { font-size: 30px; right: 10px; top: 25px; width: 30px; height: 30px; border: 2px solid #ffffff; }
    .nav-btn { display: none }
  }
  @media (min-width: 651px) and (max-width: 1000px) {
    .web-stories-wrapper { gap: 30px; grid-template-columns: 1fr 1fr; }
  }
  @media (min-width: 1001px) and (max-width: 1400px) {
    .web-stories-wrapper { gap: 20px; grid-template-columns: 1fr 1fr 1fr; }
  }

</style>

<script>
  const stories = [
    {% for block in section.blocks %}
      {
        slug: {{ block.settings.title | handleize | json }},
        title: {{ block.settings.title | json }},
        settings: {
          {% assign first_output = true %}
    {% for i in (1..10) %}
      {% assign img_key = 'image_' | append: i %}
      {% assign cap_key = 'caption_' | append: i %}
      {% assign desc_key = 'description_' | append: i %}
      {% assign link_url_key = 'link_url_' | append: i %}
      {% assign link_text_key = 'link_text_' | append: i %}
      
      {% assign has_output = false %}
      
      {% if block.settings[img_key] %}
        {% if first_output == false %},{% endif %}
        "image_{{ i }}": {{ block.settings[img_key] | image_url | json }}
        {% assign first_output = false %}
        {% assign has_output = true %}
      {% endif %}
      
      {% if block.settings[cap_key] %}
        {% if first_output == false or has_output %},{% endif %}
        "caption_{{ i }}": {{ block.settings[cap_key] | json }}
        {% assign first_output = false %}
        {% assign has_output = true %}
      {% endif %}
      
      {% if block.settings[desc_key] %}
        {% if first_output == false or has_output %},{% endif %}
        "description_{{ i }}": {{ block.settings[desc_key] | json }}
        {% assign first_output = false %}
        {% assign has_output = true %}
      {% endif %}
      
      {% if block.settings[link_url_key] %}
        {% if first_output == false or has_output %},{% endif %}
        "link_{{ i }}": {{ block.settings[link_url_key] | json }}
        {% assign first_output = false %}
        {% assign has_output = true %}
      {% endif %}
      
      {% if block.settings[link_text_key] %}
        {% if first_output == false or has_output %},{% endif %}
        "link_text_{{ i }}": {{ block.settings[link_text_key] | json }}
        {% assign first_output = false %}
      {% endif %}
      
    {% endfor %}
        }
      },
    {% endfor %}
  ];

  let currentStoryIndex = 0;
  let currentImageIndex = 0;
  let images = [], captions = [], descriptions = [], links = [];
  let slideInterval;
  const slideDuration = 8000;

  function openStoryBySlug(slug) {
    const index = stories.findIndex(story => story.slug === slug);
    if (index !== -1) openStory(index);
  }

  function openStory(index) {
    const story = stories[index];
    if (!story) return;

    currentStoryIndex = index;
    currentImageIndex = 0;
    images = []; captions = []; descriptions = []; links = [];

    for (let i = 1; i <= 10; i++) {
      const img = story.settings[`image_${i}`];
      if (img) {
        images.push(img);
        captions.push(story.settings[`caption_${i}`] || '');
        descriptions.push(story.settings[`description_${i}`] || '');
        links.push(story.settings[`link_${i}`] || '#');
      }
    }

    updateSlide(0);
    document.getElementById("story-modal").style.display = "flex";
    history.replaceState(null, '', '/pages/web-stories/' + story.slug);
  }

  function updateSlide(index) {
    if (!images[index]) return;

    document.getElementById("story-img").src = images[index];
    document.getElementById("story-title").textContent = captions[index];
    document.getElementById("story-desc").textContent = descriptions[index];

    const linkUrl = links[index];
    const linkText = stories[currentStoryIndex].settings[`link_text_${index + 1}`];
    const linkEl = document.getElementById("story-link");

    if (linkUrl && linkText) {
      linkEl.href = linkUrl;
      linkEl.textContent = linkText;
      linkEl.style.display = "flex";
    } else {
      linkEl.style.display = "none";
    }

    const progressContainer = document.getElementById("progress-container");
    progressContainer.innerHTML = "";
    for (let i = 0; i < images.length; i++) {
      const bar = document.createElement("div");
      bar.className = "progress-bar";
      const fill = document.createElement("div");
      fill.className = "progress-fill";
      if (i < index) fill.style.width = "100%";
      else if (i === index) fill.style.width = "0%";
      bar.appendChild(fill);
      progressContainer.appendChild(bar);
    }

    startProgress(index);
  }

  function startProgress(index) {
    clearInterval(slideInterval);
    const fill = document.querySelectorAll(".progress-fill")[index];
    let startTime = Date.now();

    slideInterval = setInterval(() => {
      const elapsed = Date.now() - startTime;
      const percent = Math.min((elapsed / slideDuration) * 100, 100);
      fill.style.width = percent + "%";

      if (percent >= 100) {
        clearInterval(slideInterval);
        if (currentImageIndex + 1 < images.length) {
          currentImageIndex++;
          updateSlide(currentImageIndex);
        } else {
          closeStory();
        }
      }
    }, 50);
  }

  function closeStory() {
    document.getElementById("story-modal").style.display = "none";
    clearInterval(slideInterval);
    history.replaceState(null, '', '/pages/web-stories');
  }

  function nextImage() {
    clearInterval(slideInterval);
    currentImageIndex = (currentImageIndex + 1) % images.length;
    updateSlide(currentImageIndex);
  }

  function prevImage() {
    clearInterval(slideInterval);
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    updateSlide(currentImageIndex);
  }

  function shareCurrentStory() {
    const story = stories[currentStoryIndex];
    const shareUrl = window.location.origin + '/pages/web-stories/' + story.slug;
    const title = story.title || 'Check out this story!';

    if (navigator.share) {
      navigator.share({
        title: title,
        url: shareUrl
      }).catch(err => console.log('Share cancelled or failed:', err));
    } else {
      navigator.clipboard.writeText(shareUrl).then(() => {
        alert("Link copied to clipboard!");
      }).catch(err => {
        console.error("Clipboard copy failed:", err);
      });
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll(".story").forEach((el, index) => {
      el.addEventListener("click", () => openStory(index));
    });

    document.getElementById("next-img").addEventListener("click", nextImage);
    document.getElementById("prev-img").addEventListener("click", prevImage);
    document.getElementById("story-share-btn").addEventListener("click", shareCurrentStory);

    document.getElementById("story-img").addEventListener("click", (e) => {
      const rect = e.target.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      if (clickX < rect.width / 2) {
        prevImage();
      } else {
        nextImage();
      }
    });

    const slugFromUrl = window.location.pathname.split("/").pop();
    if (slugFromUrl && slugFromUrl !== "web-stories") {
      setTimeout(() => openStoryBySlug(slugFromUrl), 300);
    }
  });
</script>

{% schema %}
{
  "name": "Web Stories with Carousel",
  "settings": [
    {
      "type": "text",
      "id": "head",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "subhead",
      "label": "Sub Heading"
    }
  ],
  "blocks": [
    {
      "type": "story",
      "name": "Story",
      "settings": [
        { "type": "header", "content": "Story 1" },
        { "type": "text", "id": "title", "label": "Story Title" },
        { "type": "image_picker", "id": "image_1", "label": "Image 1" },
        { "type": "text", "id": "caption_1", "label": "Title 1" },
        { "type": "textarea", "id": "description_1", "label": "Description 1" },
        { "type": "text", "id": "link_text_1", "label": "Link Text 1" },
        { "type": "url", "id": "link_url_1", "label": "Link URL 1" },

        { "type": "header", "content": "Story 2" },
        { "type": "image_picker", "id": "image_2", "label": "Image 2" },
        { "type": "text", "id": "caption_2", "label": "Title 2" },
        { "type": "textarea", "id": "description_2", "label": "Description 2" },
        { "type": "text", "id": "link_text_2", "label": "Link Text 2" },
        { "type": "url", "id": "link_url_2", "label": "Link URL 2" },

        { "type": "header", "content": "Story 3" },
        { "type": "image_picker", "id": "image_3", "label": "Image 3" },
        { "type": "text", "id": "caption_3", "label": "Title 3" },
        { "type": "textarea", "id": "description_3", "label": "Description 3" },
        { "type": "text", "id": "link_text_3", "label": "Link Text 3" },
        { "type": "url", "id": "link_url_3", "label": "Link URL 3" },

        { "type": "header", "content": "Story 4" },
        { "type": "image_picker", "id": "image_4", "label": "Image 4" },
        { "type": "text", "id": "caption_4", "label": "Title 4" },
        { "type": "textarea", "id": "description_4", "label": "Description 4" },
        { "type": "text", "id": "link_text_4", "label": "Link Text 4" },
        { "type": "url", "id": "link_url_4", "label": "Link URL 4" },

        { "type": "header", "content": "Story 5" },
        { "type": "image_picker", "id": "image_5", "label": "Image 5" },
        { "type": "text", "id": "caption_5", "label": "Title 5" },
        { "type": "textarea", "id": "description_5", "label": "Description 5" },
        { "type": "text", "id": "link_text_5", "label": "Link Text 5" },
        { "type": "url", "id": "link_url_5", "label": "Link URL 5" },
        
        { "type": "header", "content": "Story 6" },
        { "type": "image_picker", "id": "image_6", "label": "Image 6" },
        { "type": "text", "id": "caption_6", "label": "Title 6" },
        { "type": "textarea", "id": "description_6", "label": "Description 6" },
        { "type": "text", "id": "link_text_6", "label": "Link Text 6" },
        { "type": "url", "id": "link_url_6", "label": "Link URL 6" },

        { "type": "header", "content": "Story 7" },
        { "type": "image_picker", "id": "image_7", "label": "Image 7" },
        { "type": "text", "id": "caption_7", "label": "Title 7" },
        { "type": "textarea", "id": "description_7", "label": "Description 7" },
        { "type": "text", "id": "link_text_7", "label": "Link Text 7" },
        { "type": "url", "id": "link_url_7", "label": "Link URL 7" },

        { "type": "header", "content": "Story 8" },
        { "type": "image_picker", "id": "image_8", "label": "Image 8" },
        { "type": "text", "id": "caption_8", "label": "Title 8" },
        { "type": "textarea", "id": "description_8", "label": "Description 8" },
        { "type": "text", "id": "link_text_8", "label": "Link Text 8" },
        { "type": "url", "id": "link_url_8", "label": "Link URL 8" },

        { "type": "header", "content": "Story 9" },  
        { "type": "image_picker", "id": "image_9", "label": "Image 9" },
        { "type": "text", "id": "caption_9", "label": "Title 9" },
        { "type": "textarea", "id": "description_9", "label": "Description 9" },
        { "type": "text", "id": "link_text_9", "label": "Link Text 9" },
        { "type": "url", "id": "link_url_9", "label": "Link URL 9" },
        
        { "type": "header", "content": "Story 10" },
        { "type": "image_picker", "id": "image_10", "label": "Image 10" },
        { "type": "text", "id": "caption_10", "label": "Title 10" },
        { "type": "textarea", "id": "description_10", "label": "Description 10" },
        { "type": "text", "id": "link_text_10", "label": "Link Text 10" },
        { "type": "url", "id": "link_url_10", "label": "Link URL 10" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Web Stories with Carousel",
      "category": "Custom"
    }
  ]
}
{% endschema %}
